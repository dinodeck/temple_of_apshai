5 REMCOPYRIGHT 1979,AUTOMATED SIMULATIONS,REV1
10 CLEAR600:DEFINTD,H-Z
12 Q=60:DIMP(4),S(4),ZA(3),ZD(5),TX(3,1),TY(3,1),TM(5),H(3),T$(9),RF(3),RN(3)
13 Q1=12:DIMM$(Q1):C%=15360:KM=0:B1$="      "
15 Q2=20:CLS:DATA0,2,-1,2,-2,6,2,1,4,1,12,-2,1,-2,2,18,-2,-1,-4,-1,10,13,2,1,1:FORI=0TO3:READH(I):FORJ=0TO1:READTX(I,J),TY(I,J):NEXTJ:NEXTI:FORI=1TO5:READTM(I):NEXTI
16 KA=-1*(65536-46864):NO=KA:NT=4*Q+KA:D1=8*Q+KA:D2=12*Q+KA:MT=16*Q+KA:MN=MT+Q:NP=MN+Q:XP=NP+Q:YP=XP+Q:TR=YP+Q:XR=TR+Q:YR=XR+Q:KB=KA+2251:FORI=1TO60:POKEKA-I,0:NEXTI
17 X1=YR+Q:X2=X1+2*Q:Y1=X2+2*Q:Y2=Y1+2*Q:TN=Y2+2*Q:TV=TN+10:TP=TV+10:TG=TP+10:TW=TG+10:TS=TW+Q2:UL=TS+Q2:UA=UL+Q1:UP=UA+Q1:US=UP+Q1:UD=US+Q1:UC=UD+Q1:UR=UC+Q1:UI=UR+Q1:UW=UI+Q1:UV=UW+Q1
20 C%=15360:BL$=STRING$(15," "):ZD(0)=3:ZA(1)=0:ZD(1)=0:ZA(2)=3:ZD(2)=3:ZA(3)=-6:ZD(3)=-2:ZD(4)=5:ZD(5)=5:SE=100
25 DATA"FLAME","DUST","MOLD","PIT","","SPEAR","NEEDLE","XBOW","CAVEIN","CEILING"
45 FORI=0TO9:READT$(I):NEXTI:J9=191:J6=64:GOTO5000
50 PC=PC-1:POKEKB+24,PEEK(KB+24)-1:POKEKA-92,PEEK(KA-92)-1:RETURN
55 YY=W1-W2-5:IFYM>YYTHENYM=YYELSEIFYM<5THENYM=5
56 XX=V2-V1-5:IFXM>XXTHENXM=XXELSEIFXM<5THENXM=5
57 RETURN
60 PRINT@945,J;"ARROWS";:RETURN
65 PRINTCHR$(23);:FORI=1TO30:NEXTI:PRINTCHR$(28);:RETURN
70 GOSUB500:IFL=0GOTO70ELSEJ=ASC(C$)-48:IFJ<0ORJ>9GOTO70ELSERETURN
72 PRINT@503,B1$;:PRINT@503,PEEK(KB+13);:RETURN
74 PRINT@569,B1$;:PRINT@569,PEEK(KB+14);:RETURN
80 FORI=1TO60:POKEKA-I,0:NEXTI:RETURN
82 FORI=0TO3:RN(I)=0:IFRF(I)>0THENPOKENT+KR+I*Q,3:POKEKA-61+KR,0:RN(I)=1:RF(I)=0
84 NEXTI:I=KF+1:IFI>3THENI=I-4
85 IFRN(KF-1)>0THENRF(I)=1
86 RETURN
90 POKEN,PEEK(IA+NN):NN=NN+1:RETURN
100 L1=YY:L2=YY+L-1:IFL1<0THENL1=0:IFL2<0THENRETURN
101 IFL2>47THENL2=47:IFL1>47THENRETURN
102 L3=INT((L1+3)/3):L4=INT((L2-3)/3):LM=3*L4+3:LX=3*L3-1:IFLM<L1THENLM=L1
103 IFLX>L2THENLX=L2
104 FORII=XXTOXX+1:IFII<0ORII>47THENRETURN
105 I=2*II:FORIK=L1TOLX:GOSUB400:NEXTIK:FORIK=LMTOL2:GOSUB400:NEXTIK
110 IFL4>=L3THENFORNY=L3TOL4:POKEC%+II+64*NY,J9:NEXTNY
115 NEXTII:RETURN
120 L1=YY:L2=YY+L-1:IFL1<0THENL1=0:IFL2<0THENRETURN
121 IFL2>47THENL2=47:IFL1>47THENRETURN
122 FORI=0TOI1:NX=2*XX+I:IFNX<0ORNX>96THENRETURN
125 FORJ=L1TOL2:RESET(NX,J):NEXTJ:NEXTI:RETURN
140 L1=2*XX:L2=L1+L-1:IFL1<0THENL1=0:IFL2<0THENRETURN
141 IFL2>95THENL2=95:IFL1>95THENRETURN
142 FORI=0TOI1:NY=YY+I:IFNY<0ORNY>47THENRETURN
145 FORJ=L1TOL2:SET(J,NY):NEXTJ:NEXTI:RETURN
150 L1=2*XX:L2=L1+L-1:IFL1<0THENL1=0:IFL2<0THENRETURN
151 IFL2>95THENL2=95:IFL1>95THENRETURN
152 FORI=0TOI1:NY=YY+I:IFNY<0ORNY>47THENRETURN
155 FORJ=L1TOL2:RESET(J,NY):NEXTJ:NEXTI:RETURN
200 I1=1
205 XX=2*(XA-XB)-1:YY=YB-YA:IFKF=2ORKF=4GOTO230
210 FORI=XX-3TOXX+1STEP4:IK=YY-(KF-1)/2:ONI1GOSUB400,410:IK=IK+1:ONI1GOSUB400,410:NEXTI:I=XX-1:IK=YY-2+KF:ONI1GOSUB400,410:RETURN
230 FORIK=YY-1TOYY+1STEP2:I=XX-5+KF:ONI1GOSUB400,410:I=I+2:ONI1GOSUB400,410:NEXTIK:IK=YY:I=XX+5-2*KF:ONI1GOSUB400,410:RETURN
250 I1=2:GOTO205
300 I1=1
305 XX=2*(XM-XB+V1)-1:YY=YB-YM-W2:I=XX:IK=YY-1:ONI1GOSUB400,410:IK=YY+1:ONI1GOSUB400,410:IK=YY:FORI=XX-2TOXX+2STEP4:ONI1GOSUB400,410:NEXTI:RETURN
345 IFNB=0THENRETURN
350 I1=2:GOTO305
400 IFI<0ORI>94ORIK<0ORIK>47THENRETURNELSEFORJ=0TO1:SET(I+J,IK):NEXTJ:RETURN
410 IFI<0ORI>94ORIK<0ORIK>47THENRETURNELSEFORJ=0TO1:RESET(I+J,IK):NEXTJ:RETURN
440 IFK=0THENSET(I,YY-J):SET(I,YY+J):ELSERESET(I,YY-J):RESET(I,YY+J)
445 RETURN
450 FORL=0TO2:FORK=0TO1:I=XX+1:J=1:GOSUB440:I=XX-1:GOSUB440:I=XX+2:J=0:GOSUB440:I=XX-2:GOSUB440
460 I=XX+2:J=2:GOSUB440:I=XX-2:GOSUB440:I=XX+4:J=0:GOSUB440:I=XX-4:GOSUB440:NEXTK:NEXTL:RETURN
500 LE=SE/(NB+1):FORIC=1TOLE
510 C$=INKEY$:IFLEN(C$)>0THENL=1:RETURN
520 NEXTIC:L=0:RETURN
600 II=2*(XL-XB+V1-1):IJ=YB-YL-W2:FORL=0TO1:I=II+TX(KF-1,L):IK=IJ+TY(KF-1,L):IFK=0THENGOSUB400:ELSEGOSUB410
610 NEXTL:RETURN
650 PH=PEEK(KB+24):TA=TA-(ABS(M)/MM*(100/PH+5-5*PC/PH)*(1+WC/WT*3)/2)+11:IFTA>100THENTA=100
660 PRINT@184,B1$;:PRINT@184,TA;"%";:RETURN
670 Y=YB-PEEK(YP+KR)-W2:X=PEEK(XP+KR)+V1-XB:FORL=1TO15:I=2*X:IK=Y:GOSUB400:GOSUB410:NEXTL:RETURN
679 IFPEEK(TR+KR)=0THENRETURN
680 I=2*(V1+PEEK(XR+KR)-XB):YY=YB-W2-PEEK(YR+KR):FORIK=YY-1TOYY:IFPEEK(TR+KR)>0THENGOSUB400ELSEGOSUB410
690 NEXTIK:RETURN
695 N=PEEK(NP+KR):L=0:IFNB>0ORN=0ORABS(XL-PEEK(XP+KR))>3ORABS(YL-PEEK(YP+KR))>3ORRND(100)>PEEK(TP+N)THENRETURN
700 PRINT@624,BL$;:PRINT@624,T$(PEEK(TG+N));" TRAP";:GOSUB65:GOSUB65:IFPEEK(TN+N)>0THENI=PEEK(TN+N):NB=1:GOSUB4830:XM=PEEK(XP+KR):YM=PEEK(YP+KR):PRINT@624,A$;:GOTO720
710 IFPEEK(TV+N)>0THENML=PEEK(TV+N):L=1:MD=2*ML
720 POKENP+KR,0:RETURN
800 LL=KR:GOTO850
840 LL=LR
850 V3=PEEK(X1+LL)+128*PEEK(X1+Q+LL):V4=PEEK(X2+LL)+128*PEEK(X2+Q+LL):W3=PEEK(Y1+LL)+128*PEEK(Y1+Q+LL):W4=PEEK(Y2+LL)+128*PEEK(Y2+Q+LL):IFLL<>KRTHENRETURN
860 V1=V3:V2=V4:W1=W3:W2=W4:RETURN
880 K=0:MO=KA+2121:FORLL=1TOMQ:L=PEEK(K+MO):K=K+L+1:NEXTLL:K=K-L-1:A$="":FORLL=1TOL:A$=A$+CHR$(PEEK(K+MO+LL)):NEXTLL:RETURN
1200 XA=PEEK(KA+2236):YA=PEEK(KA+2237):KF=PEEK(KA+2238):PW=PEEK(KA+2235):EX#=PEEK(KB+3)*65536+PEEK(KB+2)*256+PEEK(KB+1):FORI=61TO80:POKEKA-I,0:NEXTI
1210 MM=4:PH=PEEK(KB+24):PC=PH:PB=PEEK(KB+18):PA=PEEK(KB+19):PS=PEEK(KB):AA=PEEK(KB+8):TA=100:AS=PEEK(KB+23)/10:WM=PEEK(KB+7):SE=PEEK(KB+9):WT=AS*AS*100:WC=PEEK(KB+12):SM=PEEK(KB+10):RETURN
3000 IFPEEK(KA+LR-61)=1THENRETURNELSEGOSUB840:XX=V4-XB-2:IFV3-XB>-1ANDV4-XB<49ANDYB-W3>-1ANDYB-W4<49THENPOKEKA+LR-61,1
3011 FORK=1TO3STEP2:NN=LR+K*Q:YY=YB-W3:IFNS=KGOTO3014ELSEI1=3:L=W3-W4:IFPEEK(D2+NN)-PEEK(D1+NN)+4=LGOTO3014ELSEGOSUB100
3012 I1=5-2*PEEK(NT+NN):IFI1>=0ANDI1<5THENYY=YB-W4-PEEK(D2+NN):L=PEEK(D2+NN)-PEEK(D1+NN):GOSUB120
3014 XX=V3-XB:NEXTK
3032 YY=YB-W3:FORK=0TO2STEP2:NN=LR+K*Q:IFNS=KGOTO3034ELSEI1=1:XX=V3-XB:L=2*(V4-V3):IFPEEK(D2+NN)-PEEK(D1+NN)+4=L/2GOTO3034ELSEGOSUB140:I1=2-PEEK(NT+NN):IFI1>=0ANDI1<2THENXX=V3-XB+PEEK(D1+NN):L=2*(PEEK(D2+NN)-PEEK(D1+NN)):GOSUB150
3034 YY=YB-W4-2:NEXTK:RETURN
4000 LR=KR:GOSUB800:IFPEEK(KA+KR-61)=1GOTO4005ELSECLS:GOSUB80
4002 XB=V1:YB=W1:IFPEEK(NT+LR+3*Q)=1THENXB=XB-(48-V2+V1)/2:IFPEEK(NT+LR+Q)=1THENXB=XB+(V1-XB)/2
4003 IFPEEK(NT+LR)=1THENYB=YB+48-W1+W2:IFPEEK(NT+LR+2*Q)=1THENYB=YB-(YB-W1)/2
4004 PRINT@624,BL$;:XL=XA-V1:YL=YA-W2:IFPEEK(MT+KR)>0ANDPEEK(MN+KR)>0THENGOSUB4500:NB=1:ELSEGOSUB4800
4005 PRINT@48,"ROOM NO.:"KR;:PRINT@112,"WOUNDS:"INT(100*PC/PH+.5);"%";:PRINT@176,"FATIGUE:"TA;"%";:PRINT@240,"WGT:"WC;" LBS";:PRINT@624,A$;:PRINT@496,"ARROWS:"PEEK(KB+13);:PRINT@560,"MAGIC AR:"PEEK(KB+14);:PRINT@752,"TOTAL SLAIN:";:PRINT@816,KC;
4010 IFNB>0THENGOSUB300
4020 NS=5:IFIB=3GOTO4050
4030 FORIR=0TO3:I=KR+IR*Q:IFPEEK(NT+I)=1ANDPEEK(NO+I)>0THENLR=PEEK(NO+I):GOSUB3000
4040 NEXTIR
4050 LR=KR:GOSUB3000:GOSUB200:GOSUB679:RETURN
4500 MQ=PEEK(MT+KR):MW=0:ML=PEEK(UL+MQ):MA=PEEK(UA+MQ):MP=PEEK(UP+MQ):MS=PEEK(UV+MQ):MD=PEEK(UD+MQ):MH=PEEK(UC+MQ):MR=0:GOSUB880:IH=0
4520 XM=RND(V2-V1-8)+4:YM=RND(W1-W2-8)+4
4550 MF=RND(4):RETURN
4800 L=RND(100):IFL>PWTHENNB=0:A$="":RETURN
4810 L=RND(100):LS=0:NB=1:FORI=1TOQ1:LS=LS+PEEK(UW+I):IFL<=LSGOTO4830
4820 NEXTI
4830 POKEMT+KR,I:POKEMN+KR,1:MQ=I:ML=PEEK(UL+I):MA=PEEK(UA+I):MP=PEEK(UP+I):MS=PEEK(UV+I):MD=PEEK(UD+I):MH=PEEK(UC+I):GOSUB880:IH=0:GOSUB4520:RETURN
4850 L=RND(100):IFL<PW/6GOTO4810ELSERETURN
5000 KR=1:O$="RLATPFMGEV!HQSYDO":GOSUB1200
5030 GOSUB4000:S(1)=W1-W2:S(2)=V2-V1:S(3)=0:S(4)=0'BUILD INITIAL ROOM
5040 P(1)=XA-V1:P(2)=YA-W2:P(3)=P(1):P(4)=P(2):P(0)=P(2)
5044 X0=XL:Y0=YL:IA=0:GOSUB500:M=0:PRINT@304,BL$;:PRINT@368,BL$;:PRINT@432,BL$;:IFL=0GOTO7000
5045 IA=0:IFASC(C$)>47ANDASC(C$)<58GOTO5100ELSEFORI=1TO17:IFC$=MID$(O$,I,1)THENONIGOTO5300,5350,5390,5390,5390,5390,5390,5800,5700,5370,5900,6100,6200,6300,6140,5850,5600
5050 NEXTI:GOTO5044
5100 IFTA<1GOTO5390:ELSEM=ASC(C$)-48
5110 M1=M:N=PEEK(NP+KR):IB=0:ONKFGOTO5120,5210,5164,5250
5120 IFYA+M>W1-3THENM=W1-3-YA:IB=1
5150 GOTO5281
5164 M=-M:M1=M:IFYA+M<W2+4THENM=W2+4-YA:IB=1
5180 GOTO5281
5210 IFXA+M>V2-3THENM=V2-3-XA:IB=1
5240 GOTO5281
5250 M=-M:M1=M:IFXA+M<V1+4THENM=V1+4-XA:IB=1
5270 GOTO5281
5280 IFNB>0GOTO7000ELSEGOTO7020
5281 IFIB=0GOTO5290:ELSEXL=XA-V1:YL=YA-W2:IFPEEK(NT+KR+KF*Q-Q)<>1GOTO5290
5282 L=KR+KF*Q-Q:IFP(KF)>PEEK(D1+L)ANDP(KF)<PEEK(D2+L)THENGOSUB345:GOSUB82:NB=0:IN=0:KR=PEEK(NO+L):GOSUB800:IB=2:M=ABS(M)+4:IFKR=0GOTO10000
5284 IFIB=1GOTO5290
5285 IFV1-XB>-1ANDV2-XB<49ANDYB-W1>-1ANDYB-W2<49THENIB=3:S(1)=W1-W2:S(2)=V2-V1:M=M1:GOTO5290
5286 IFKF=1THENYA=W2+4:GOTO5030
5287 IFKF=3THENYA=W1-4:GOTO5030
5288 IFKF=2THENXA=V1+4:ELSEXA=V2-4
5289 GOTO5030
5290 GOSUB250:GOSUB679:IFKF=1ORKF=3THENYA=YA+M:ELSEXA=XA+M
5291 IFPEEK(KA-86)>0THENM=M/2
5292 GOSUB200:P(1)=XA-V1:P(3)=P(1):P(2)=YA-W2:P(4)=P(2):P(0)=P(2):IFIB=3THENLR=KR:GOSUB4004:IB=0:GOTO5044
5295 XL=XA-V1:YL=YA-W2:GOSUB695:IFL>0THENGOSUB650:GOTO7020ELSEGOTO7000
5300 GOSUB250:KF=KF+1:IFKF>4THENKF=1
5310 GOSUB200:GOTO5044
5350 GOSUB250:KF=KF-1:IFKF<1THENKF=4
5360 GOSUB200:GOTO5044
5370 GOSUB250:KF=KF-2:IFKF<1THENKF=KF+4
5380 GOSUB200:GOTO5044
5390 IFTA<1THENPRINT@368,BL$;:PRINT@368,"TOO TIRED";:GOTO7000:ELSEIA=I-2:IN=0:KM=0:ONIAGOTO5400,5400,5400,5500,5490
5400 HI=0:IFABS(XL-XM)>5ORABS(YL-YM)>5THENPRINT@368,"TOO FAR TO HIT";:GOTO7000
5430 M=TM(IA):K=0:GOSUB600:P=PB-(PEEK(KB+22)-9)/3*EXP(-2*PC/PH)+ML/3-ZA(    IA):R=RND(20):IFR<PTHENPRINT@368,"SWISH!";:GOTO6990
5435 AK=AS*(R-P+1):PRINT@368,"CRUNCH!";:IFAK>WMTHENAK=WM
5437 IFAK<MHTHENAK=MH
5440 IFPEEK(US+MQ)<>2OR(PEEK(KB+10)>0ANDIA<3)ORIA=4THENMP=MP-AK+MH:IN=0
5450 GOTO6990
5490 I1=5:KM=5:IFPEEK(KB+14)<=0GOTO7000:ELSEPOKEKB+14,PEEK(KB+14)-1:GOSUB74:GOTO5505
5500 I1=3:IFPEEK(KB+13)<=0GOTO7000:ELSEPOKEKB+13,PEEK(KB+13)-1:GOSUB72
5505 ONKFGOTO5510,5550,5515,5555
5510 LY=YL+2:UY=YM-3:S=1:GOTO5520
5515 LY=YL-2:UY=YM+3:S=-1
5520 X=XL-1:FORY=LYTOUYSTEPS:I=2*(X+V1-XB):J=YB-Y-W2:SET(I,J):RESET(I,J):X=X*1:NEXTY:GOTO5580
5550 LX=XL+1:UX=XM-3:S=1:GOTO5560
5555 LX=XL-3:UX=XM+3:S=-1
5560 Y=YL:FORX=LXTOUXSTEPS:I=2*(X+V1-XB):J=YB-Y-W2:SET(I,J):RESET(I,J):Y=Y*1:NEXTX
5580 IFABS(X-XM)<I1ANDABS(Y-YM)<I1THENPRINT@368,"THWUNK!";:AK=RND(7)+KM:GOTO5437:ELSEPRINT@368,"SSWHT!";:GOTO7000
5600 K=KR+KF*Q-Q:IFPEEK(NT+K)=2THENIFP(KF)>PEEK(D1+K)ANDP(KF)<PEEK(D2+K)THENIFABS(P(KF-1)-S(KF))<6THENPOKENT+K,1:IJ=0:ONKFGOSUB5660,5620,5680,5640:GOTO5605
5603 GOTO7000
5605 LR=PEEK(NO+K):NS=KF+1:IFNS>3THENNS=NS-4
5607 POKENT+LR+NS*Q,1:NS=5:GOSUB3000:GOTO7000
5620 XX=V2-XB-2
5630 I1=3+IJ:YY=YB-W2-PEEK(D2+K):L=PEEK(D2+K)-PEEK(D1+K):GOSUB120:RETURN
5640 XX=V1-XB:GOTO5630
5660 YY=YB-W1
5670 I1=1+IJ/2:XX=V1-XB+PEEK(D1+K):L=2*(PEEK(D2+K)-PEEK(D1+K)):GOSUB150:RETURN
5680 YY=YB-W2-2:GOTO5670
5700 K=KR+(KF-1)*Q:IFPEEK(K+NT)=3ANDRND(40)<20+PEEK(KB+21)THENPOKEK+NT,2:RF(KF-1)=1:PRINT@304,BL$;:PRINT@304,"A SECRET DOOR!";:IJ=-2:LR=KR:ONKFGOSUB5660,5620,5680,5640:ELSEPRINT@304,"NOTHING";
5710 GOTO7000
5800 N=PEEK(TR+KR):PRINT@304,BL$;:IFN=0ORXL-PEEK(XR+KR)>3ORYL-PEEK(YR+KR)>3THENPRINT@304,"YOU CAN'T";:GOTO7000:ELSEPOKETR+KR,0:PRINT@304,"TREASURE #"N;:POKEKA+N-81,PEEK(KA+N-81)+1:WC=WC+PEEK(TW+N):PRINT@240,"WGT:"WC;:IN=0
5803 GOSUB680:I=PEEK(TS+N):IFI>100THENJ=KB+I-81:POKEJ,PEEK(J)+1:J=KA+I-197:POKEJ,PEEK(J)+1:GOTO7000:ELSEONI+1GOTO7000,5810,5815,5820,5825,5830,5835,5805,5840,5845,5846,12000
5805 POKEKA-89,1:GOTO7000
5810 J=RND(6):PRINT@945,J;"ITEMS";:POKEKB+6,PEEK(KB+6)+J:GOTO7000
5815 PS=4:SP=SP+1:GOTO7000
5820 PRINT@944,"DOST USE SWORD?";:GOSUB500:IFL=0GOTO5820ELSEPRINT@944,BL$;:IFC$="Y"THENPB=PB+SM:SM=RND(4)+RND(4)-4:PB=PB-SM:WM=AS*(7+SM)+.5:IFSM>0THENSM=SM-INT(2-PEEK(KA)/2):IFSM>1THENPRINT@944,"THE SWORD GLOWS";
5821 IFC$<>"Y"THENPOKEKA+N-81,PEEK(KA+N-81)-1:WC=WC-PEEK(TW+N):PRINT@944,BL$;
5822 GOTO7000
5825 J=RND(20):GOSUB60:POKEKB+13,PEEK(KB+13)+J:GOSUB72:GOTO7000
5830 J=RND(10):GOSUB60:POKEKB+14,PEEK(KB+14)+J:GOSUB74:GOTO7000
5835 POKEKA-90,1:PA=PA+1:GOTO7000
5840 POKEKA-88,1:GOTO7000
5845 POKEKA-87,1:GOTO7000
5846 PW=75:POKEKA+2235,PW:GOTO7000
5850 PRINT@944,"DROP SOME?";
5860 GOSUB70:JJ=10*J:GOSUB70:JJ=JJ+J:IFJJ<21THENI=PEEK(KA+JJ-81):IFI>0THENPOKEKA+JJ-81,I-1:WC=WC-PEEK(TW+JJ):PRINT@944,BL$;:PRINT@240,"WGT:"WC;:IFPEEK(TR+KR)=0THENPOKETR+KR,JJ:POKEXR+KR,XL:POKEYR+KR,YL:GOSUB680
5870 PRINT@944,BL$;:GOTO7000
5900 IFRND(100)<.3*(PEEK(KB+20)+PEEK(KB+22))*PEEK(UI+MQ)THENIN=1ELSEGOTO7000
5910 PRINT@304,BL$;:PRINT@304,"PASS BY";:GOTO7000
6100 IFPEEK(KB+11)>0THENPOKEKB+11,PEEK(KB+11)-1:J=0ELSEGOTO6150
6110 PC=PC+1+J:IFPC>PHTHENPC=PH
6130 PRINT@945,BL$;:PRINT@119,"     ";:PRINT@119,INT(100*PC/PH+.5);"%";:GOTO7000
6140 I=KB+6:IFPEEK(I)>0THENPOKEI,PEEK(I)-1:J=RND(6)+1:GOTO6110
6150 PRINT@945,"NONE LEFT";:GOTO5044
6200 JJ=PEEK(KB+21):PRINT@304,BL$;:I=PEEK(NO+KR+Q*KF-Q):MQ=PEEK(MT+I):IFI=0ORPEEK(MN+I)=0ORRND(1000)>JJ*JJ+PEEK(KA-89)*700THENPRINT@304,"NOTHING";:GOTO7000
6210 GOSUB880:PRINT@304,A$;:GOTO7000
6300 IFPEEK(NP+KR)>0ANDRND(20)<PEEK(KB+21)THENGOSUB670:ELSEPRINT@304,BL$;:PRINT@304,"NOTHING";
6310 GOTO7000
6990 K=1:GOSUB600
7000 GOSUB650:IFNB>0GOTO7005ELSEGOSUB4850:IFNB=0GOTO5044
7002 PRINT@688,"APPEARS";:PRINT@624,BL$;:PRINT@624,A$;:GOSUB300:GOTO5044
7005 PRINT@432,BL$;:IFIN>0ORHI>0GOTO7500
7010 IFABS(X0-XM)>5ORABS(Y0-YM)>5GOTO7300
7015 IM=MA
7017 IM=IM-1:IFIM<0GOTO7250
7020 P=PA-ZD(IA):R=RND(20)+ML:IFR<PTHENPRINT@432,BL$;:IM=IM*1:PRINT@432,"IT MISSED!";:GOTO7017
7030 GOSUB65:IFRND(20)-1<PEEK(KB+4)THENPRINT@432,BL$;:PRINT@432,"SHIELD HIT!";:K=-PS:ELSEPRINT@432,BL$;:PRINT@432,"STRUCK THEE!";:K=0:IFPEEK(US+MQ)=2ANDRND(20)>PEEK(KB+21)/2+PEEK(KA-81)ANDPEEK(KA-88)=0THENGOSUB50:PRINT@432,BL$;:PRINT@432,"A CHILL";
7040 K=K+(MD*(R-P))/10-AA-PEEK(KB+16):IFK<0THENK=0
7050 PC=PC-K:IFPC<1THENFORI=1TO1000:NEXTI:GOTO11000
7060 PRINT@119,B1$;:PRINT@119,INT(100*PC/PH+.5);"%";:IFNB>0GOTO7017ELSEGOTO5044
7250 IFNB=0GOTO5044ELSEGOSUB350:L=2:ONRND(4)GOTO7260,7270,7280,7290
7260 YM=YM+L:GOTO7490
7270 XM=XM+L:GOTO7490
7280 YM=YM-L:GOTO7490
7290 XM=XM-L:GOTO7490
7300 GOSUB350:GOSUB679:XX=XL-XM:YY=YL-YM:IFABS(XX)<ABS(YY)GOTO7306:ELSEIFXX>0THENMF=2ELSEMF=4
7304 GOTO7310
7306 IFYY>0THENMF=1ELSEMF=3
7310 L=MS:ONMFGOTO7320,7360,7400,7440
7320 IFYM+L>YL-3THENYM=YL-3:ELSEYM=YM+L
7330 GOTO7490
7360 IFXM+L>XL-3THENXM=XL-3:ELSEXM=XM+L
7370 GOTO7490
7400 IFYM-L<YL+3THENYM=YL+3:ELSEYM=YM-L
7410 GOTO7490
7440 IFXM-L<XL+3THENXM=XL+3:ELSEXM=XM-L
7490 GOSUB55:GOSUB300
7500 IFMP<1ANDNB>0THENGOSUB350:GOSUB450:EX#=EX#+20*ML*ML+15:KC=KC+1:PRINT@816,KC;:PRINT@304,BL$;:PRINT@304,"MONSTER SLAIN!";:M=PEEK(MN+KR):IFM>0THENPOKEMN+KR,M-1:IFM>1THENGOSUB4500:PRINT@304,"ANOTHER APPEARS";:GOSUB300
7510 IFMP<1THENNB=0:PRINT@368,BL$;:PRINT@432,BL$;:PRINT@624,BL$;:PRINT@688,BL$;
7520 GOTO5044
10000 CLS:PRINT"THOU LEAVEST THE DUNJON"
10010 PRINT"EXPERIENCE:"EX#:INPUT"DOST WISH TO REENTER";C$:IFLEFT$(C$,1)="Y"THENWC=PEEK(KB+12):KR=1:PC=PH:XA=PEEK(KA+2236):YA=PEEK(KA+2237):KF=PEEK(KA+2238):TA=100:GOSUB80:GOTO5030
10011 INPUT"DOST WISH TO SAVE THE DUNJON";A$:IFLEFT$(A$,1)<>"Y"GOTO10015
10012 AN$="LEVEL"+RIGHT$(STRS$(PEEK(KA)),1):OPEN"O",1,AN$
10013 K=0:FORI=1TO9:A$="":FORJ=0TO248:A$=A$+CHR$(PEEK(KA+K+J)+59):NEXTJ:PRINT#1,A$:K=K+249:NEXTI:CLOSE1
10014 PRINT"LEVEL SAVED":STOP
10015 J=EX#/256:POKEKB+1,EX#-J*256:JJ=J/256:POKEKB+2,J-JJ*256:POKEKB+3,JJ:IFSM<0THENSM=0
10020 POKEKB+10,SM:PRINT"LOADING THE INNKEEPER":RUN"INN
11000 CLS:PRINT@401,CHR$(23);"THOU ART SLAIN!":FORI=1TO2500:NEXTI:CLS:I=SQR(RND(16))+.7:ONIGOTO11010,11030,11040,11020
11010 PRINT"THOU ART EATEN":POKEKB-12,0:RUN"INN
11020 PRINT"BENEDIC THE CLERIC FOUND THEE":GOTO10010
11030 PRINT"LOWENTHAL THE MAGE FOUND THEE":FORI=81TO90:POKEKA-I,0:NEXTI:GOTO10010
11040 PRINT"OLIAS THE DWARF FOUND THEE":FORI=61TO90:POKEKA-I,0:NEXTI:SM=0:POKEKB+10,0:POKEKB+16,0:POKEKB+14,0:POKEKB+6,0:GOTO10010
